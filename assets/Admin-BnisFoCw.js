import{c as C,d as S,r as m,j as r}from"./index-DNb6WZ_m.js";import{u as T}from"./useQuery-YEbScmEl.js";import{u as p}from"./useMutation-C5cXFY06.js";import{a as i}from"./api-BZS8NOXb.js";const E=()=>{const{token:n}=C(),l=S(),[d,h]=m.useState(null),[c,u]=m.useState(!1),[a,o]=m.useState({title:"",description:"",location:"",price:0,bedrooms:0,bathrooms:0,sqm:0,virtualTourUrl:"",images:null}),{data:x,isLoading:b,error:v}=T({queryKey:["properties"],queryFn:async()=>(await i.get("/properties")).data}),j=p({mutationFn:async e=>{await i.delete(`/properties/${e}`,{headers:{Authorization:`Bearer ${n}`}})},onSuccess:()=>{l.invalidateQueries({queryKey:["properties"]})}}),f=p({mutationFn:async e=>{const t=new FormData;t.append("title",e.title),t.append("description",e.description),t.append("location",e.location),t.append("price",e.price.toString()),t.append("bedrooms",e.bedrooms.toString()),t.append("bathrooms",e.bathrooms.toString()),t.append("sqm",e.sqm.toString()),e.virtualTourUrl&&t.append("virtualTourUrl",e.virtualTourUrl),e.images&&Array.from(e.images).forEach(s=>{t.append("images",s)}),await i.post("/properties",t,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"multipart/form-data"}})},onSuccess:()=>{l.invalidateQueries({queryKey:["properties"]}),g()}}),N=p({mutationFn:async({id:e,data:t})=>{const s=new FormData;s.append("title",t.title),s.append("description",t.description),s.append("location",t.location),s.append("price",t.price.toString()),s.append("bedrooms",t.bedrooms.toString()),s.append("bathrooms",t.bathrooms.toString()),s.append("sqm",t.sqm.toString()),t.virtualTourUrl&&s.append("virtualTourUrl",t.virtualTourUrl),t.images&&Array.from(t.images).forEach(w=>{s.append("images",w)}),await i.put(`/properties/${e}`,s,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"multipart/form-data"}})},onSuccess:()=>{l.invalidateQueries({queryKey:["properties"]}),g()}}),g=()=>{o({title:"",description:"",location:"",price:0,bedrooms:0,bathrooms:0,sqm:0,virtualTourUrl:"",images:null}),h(null),u(!1)},y=e=>{h(e),o({title:e.title,description:e.description||"",location:e.location,price:e.price,bedrooms:e.bedrooms,bathrooms:e.bathrooms,sqm:e.sqm,virtualTourUrl:e.virtualTourUrl||"",images:null}),u(!0)},q=e=>{e.preventDefault(),d?N.mutate({id:d.id,data:a}):f.mutate(a)};return b?r.jsx("div",{className:"text-center",children:"Cargando..."}):v?r.jsx("div",{className:"text-center text-red-500",children:"Error al cargar propiedades."}):r.jsx("div",{className:"min-h-screen bg-gray-100",children:r.jsxs("div",{className:"container mx-auto px-4 py-8",children:[r.jsx("h1",{className:"text-4xl font-bold text-center mb-8",children:"Administración de Propiedades"}),r.jsx("button",{onClick:()=>u(!c),className:"mb-4 px-4 py-2 bg-blue-500 text-white rounded",children:c?"Cancelar":"Crear Nueva Propiedad"}),c&&r.jsxs("form",{onSubmit:q,className:"mb-8 p-4 bg-white rounded shadow-md",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx("input",{type:"text",placeholder:"Título",value:a.title,onChange:e=>o({...a,title:e.target.value}),required:!0,className:"p-2 border rounded"}),r.jsx("input",{type:"text",placeholder:"Ubicación",value:a.location,onChange:e=>o({...a,location:e.target.value}),required:!0,className:"p-2 border rounded"}),r.jsx("input",{type:"number",placeholder:"Precio",value:a.price,onChange:e=>o({...a,price:parseFloat(e.target.value)}),required:!0,className:"p-2 border rounded"}),r.jsx("input",{type:"number",placeholder:"Dormitorios",value:a.bedrooms,onChange:e=>o({...a,bedrooms:parseInt(e.target.value)}),required:!0,className:"p-2 border rounded"}),r.jsx("input",{type:"number",placeholder:"Baños",value:a.bathrooms,onChange:e=>o({...a,bathrooms:parseInt(e.target.value)}),required:!0,className:"p-2 border rounded"}),r.jsx("input",{type:"number",placeholder:"Metros cuadrados",value:a.sqm,onChange:e=>o({...a,sqm:parseFloat(e.target.value)}),required:!0,className:"p-2 border rounded"}),r.jsx("input",{type:"url",placeholder:"URL Tour Virtual",value:a.virtualTourUrl,onChange:e=>o({...a,virtualTourUrl:e.target.value}),className:"p-2 border rounded"}),r.jsx("textarea",{placeholder:"Descripción",value:a.description,onChange:e=>o({...a,description:e.target.value}),className:"p-2 border rounded md:col-span-2"}),r.jsx("input",{title:"file",type:"file",multiple:!0,accept:"image/*",onChange:e=>o({...a,images:e.target.files}),className:"p-2 border rounded md:col-span-2"})]}),r.jsx("button",{type:"submit",className:"mt-4 px-4 py-2 bg-green-500 text-white rounded",children:d?"Actualizar":"Crear"})]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x?.map(e=>r.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[r.jsx("img",{src:e.images[0]||"/placeholder.jpg",alt:e.title,className:"w-full h-48 object-cover"}),r.jsxs("div",{className:"p-4",children:[r.jsx("h3",{className:"text-xl font-semibold mb-2",children:e.title}),r.jsx("p",{className:"text-gray-600 mb-2",children:e.description}),r.jsxs("p",{className:"text-lg font-bold text-blue-600 mb-2",children:["€",e.price.toLocaleString()]}),r.jsxs("div",{className:"flex justify-between text-sm text-gray-500 mb-4",children:[r.jsxs("span",{children:[e.bedrooms," dormitorios"]}),r.jsxs("span",{children:[e.sqm," m²"]})]}),r.jsx("p",{className:"text-sm text-gray-500 mb-4",children:e.location}),r.jsxs("div",{className:"flex space-x-2",children:[r.jsx("button",{onClick:()=>y(e),className:"px-3 py-1 bg-yellow-500 text-white rounded",children:"Editar"}),r.jsx("button",{onClick:()=>j.mutate(e.id),className:"px-3 py-1 bg-red-500 text-white rounded",children:"Eliminar"})]})]})]},e.id))})]})})};export{E as default};
